name: mtest
nodes:
  - address: __NODE1__
    user: cke
  - address: __NODE2__
    user: cke
  - address: __NODE3__
    user: cke
  - address: __NODE4__
    user: cke
  - address: __NODE5__
    user: cke
service_subnet: 10.34.56.0/24
dns_servers: ["8.8.8.8", "1.1.1.1"]
reboot:
  command: ["sleep", "5"]
  eviction_timeout_seconds: 30
  command_timeout_seconds: 30
options:
  kube-api:
    extra_args:
    - --enable-admission-plugins=PodSecurityPolicy
  kube-scheduler:
    config:
      apiVersion: kubescheduler.config.k8s.io/v1alpha2
      kind: KubeSchedulerConfiguration
      leaderElection:
        leaderElect: true
      clientConnection:
        kubeconfig: /etc/kubernetes/scheduler.conf
      profiles:
        - schedulerName: default-scheduler
          plugins:
            score:
              disabled:
              - name: PodTopologySpread
              enabled:
              - name: PodTopologySpread
                weight: 500
      extenders:
      -  urlPrefix: "http://127.0.0.1:9251"
         filterVerb: predicate
         prioritizeVerb: prioritize
         nodeCacheCapable: false
         weight: 1
         managedResources:
         - name: topolvm.cybozu.com/capacity
           ignoredByScheduler: true
      priorities:
      - name: SelectorSpreadPriority
        weight: 1
      - name: InterPodAffinityPriority
        weight: 1
      - name: LeastRequestedPriority
        weight: 1
      - name: BalancedResourceAllocation
        weight: 1
      - name: NodePreferAvoidPodsPriority
        weight: 100000
      - name: NodeAffinityPriority
        weight: 1
      - name: TaintTolerationPriority
        weight: 1
      - name: ImageLocalityPriority
        weight: 1
      - name: EvenPodsSpreadPriority
        weight: 500
    extra_args:
      - "--feature-gates=EphemeralContainers=true"
  kubelet:
    extra_binds:
    - source: /mnt/disks
      destination: /mnt/disks
      read_only: false
    - source: /var/lib/k8s-containerd
      destination: /var/lib/k8s-containerd
      read_only: false
    container_runtime: __RUNTIME__
    container_runtime_endpoint: __RUNTIME_ENDPOINT__
    cni_conf_file:
      name: 98-bridge.conf
      content: |
        {
          "cniVersion": "0.3.1",
          "name": "bridge",
          "type": "bridge",
          "bridge": "cnio0",
          "isGateway": true,
          "ipMasq": true,
          "ipam": {
            "type": "host-local",
            "ranges": [
              [{"subnet": "10.1.0.0/16"}]
            ],
            "routes": [{"dst": "0.0.0.0/0"}]
          }
        }
    config:
      apiVersion: kubelet.config.k8s.io/v1beta1
      kind: KubeletConfiguration
      clusterDomain: cluster.local
      containerLogMaxSize: "1000"
      containerLogMaxFiles: 3

etcd_backup:
  enabled: false
  pvc_name: etcdbackup-pvc
  schedule: "* * * * *"
  rotate: 14
